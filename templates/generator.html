<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SCLOG — Smart CLO Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap + icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HMBYNXRLBE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-HMBYNXRLBE', { 'send_page_view': true });

    function logEvent(name, data = {}) {
      if (typeof gtag === 'function') {
        try { gtag('event', name, data); } catch(e){ console.debug('gtag error', e); }
      } else {
        console.debug('GA not ready - event', name, data);
      }
    }
  </script>

  <!-- Theme CSS -->
  <style>
    :root{
      --usm-purple: #6d28d9;
      --usm-purple-2: #8b5cf6;
      --bg-light: #f5f3ff;
      --card: #ffffff;
      --muted: #6c6480;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(15,23,42,0.06);
    }

    html,body{height:100%;}
    body {
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: var(--bg-light);
      color: #2a2344;
      line-height:1.45;
    }
    body[data-theme="dark"] {
      background: linear-gradient(180deg,#11101a,#16081f);
      color: #efe6ff;
    }

    .container-app {
      max-width:1200px;
      margin:18px auto 40px;
      padding:12px;
    }

    .card-box {
      background: var(--card);
      border-radius: var(--radius);
      padding:16px;
      border: 1px solid rgba(109,40,217,0.10);
      box-shadow: var(--shadow);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    body[data-theme="dark"] .card-box {
      background: rgba(24,14,33,0.64);
      border-color: rgba(255,255,255,0.04);
      box-shadow: 0 14px 36px rgba(0,0,0,0.5);
    }
    .card-box:hover { transform: translateY(-2px); box-shadow: 0 20px 44px rgba(109,40,217,0.08); }

    .brand { font-weight:900; font-size:1.22rem; background: linear-gradient(90deg,var(--usm-purple),var(--usm-purple-2)); -webkit-background-clip:text; color:transparent; display:flex; gap:10px; align-items:center; }
    .subtitle { color:var(--muted); font-size:.95rem; }

    label.form-label { font-weight:600; font-size:.92rem; color:var(--muted); margin-bottom:6px; display:block; }
    .form-control, .form-select {
      border-radius:12px;
      padding:10px 12px;
      font-size:.95rem;
      background:#fbf8ff;
      border:1px solid rgba(109,40,217,0.06);
    }
    body[data-theme="dark"] .form-control, body[data-theme="dark"] .form-select {
      background: rgba(22,12,34,0.54);
      color: #efe6ff;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .form-control:focus, .form-select:focus { box-shadow: 0 0 0 6px rgba(167,139,250,0.14); outline:none; border-color:var(--usm-purple); }

    .logic-box {
      background:#f7f2ff;
      padding:10px;
      border-radius:10px;
      color:#3b2a63;
      min-height:56px;
    }
    body[data-theme="dark"] .logic-box { background: rgba(34,16,48,0.4); color:#efe6ff; }

    .btn { border-radius:12px; font-weight:700; }
    .btn-primary { background: linear-gradient(90deg,var(--usm-purple),var(--usm-purple-2)); border:none; color:#fff; }
    .btn-outline-secondary { color:var(--usm-purple); border-color:var(--usm-purple); border-radius:12px; }
    .btn-outline-secondary:hover { background:var(--usm-purple); color:#fff; }

    .nav-tabs { border-bottom:none; overflow:auto; white-space:nowrap; padding-bottom:6px; }
    .nav-tabs .nav-link { border:0; margin-right:6px; background:#f3eefe; color:var(--usm-purple); border-radius:10px; padding:7px 12px; }
    .nav-tabs .nav-link.active { background:var(--usm-purple); color:#fff; font-weight:700; }

    .muted { color:var(--muted); }
    .meta-item { margin-bottom:10px; }

    footer { margin-top:18px; text-align:center; color:var(--muted); font-size:.88rem; }

    @media (max-width: 991px) { .profile-row { flex-direction:column; gap:10px; } }
    @media (max-width: 575px) {
      .card-box { padding:12px; border-radius:12px; }
      .brand { font-size:1.05rem; }
      .form-control, .form-select { padding:8px 10px; }
      .btn { padding:7px 10px; font-size:.92rem; }
    }
  </style>
</head>

<body data-theme="light">
  <div class="container-app">

    <!-- HEADER -->
    <div class="card-box mb-3 d-flex justify-content-between align-items-center">
      <div>
        <div class="brand"><i class="bi bi-stars" style="font-size:1.1rem"></i> SCLOG</div>
        <div class="subtitle">Smart Course Learning Outcome Generator — logic & mapping</div>
      </div>
      <div>
        <button id="darkToggle" class="btn btn-outline-secondary"><i class="bi bi-moon"></i> Dark</button>
      </div>
    </div>

    <!-- 1) Academic profile + Level + IEG + PEO -->
    <div class="card-box mb-3">
      
      <div class="muted mb-2">
  <strong>Step 1:</strong> Define the programme context (discipline and level) to guide
  appropriate outcome mapping and CLO complexity.
</div>

      <div class="row g-3 profile-row">
        <div class="col-12 col-md-4">
          <label class="form-label">Academic profile</label>
          <select id="profile" class="form-select">
            <option value="">Select Academic profile</option>
            <option value="health">Medical & Health</option>
            <option value="sc">Computer Science & IT</option>
            <option value="eng">Engineering & Technology</option>
            <option value="socs">Social Sciences</option>
            <option value="edu">Education</option>
            <option value="bus">Business & Management</option>
            <option value="arts">Arts & Humanities</option>
          </select>
        </div>

        <div class="col-12 col-md-2">
          <label class="form-label">Level</label>
          <select id="level" class="form-select">
            <option value="">Select Level</option>
            <option>Diploma</option>
            <option>Degree</option>
            <option>Master</option>
            <option>PhD</option>
          </select>
        </div>

        <div class="col-12 col-md-3">
          <label class="form-label">IEG</label>
          <select id="ieg" class="form-select"><option value="">Select IEG</option></select>
        </div>

        <div class="col-12 col-md-3">
          <label class="form-label">PEO (mapped)</label>
          <select id="peo" class="form-select"><option value="">Select PEO</option></select>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div class="form-label">Why this IEG → PEO?</div>
        <div id="ieg_peo_logic" class="logic-box">—</div>
      </div>
    </div>

    <!-- 2) PLO for selected PEO -->
    <div id="plo_block" class="card-box mb-3">

      <div class="muted mb-2">
  <strong>Step 2:</strong> Select the Programme Learning Outcome (PLO) aligned
  to the chosen PEO.
</div>

      <label class="form-label">PLO for selected PEO</label>
      <select id="plo" class="form-select mb-3"><option value="">Select PLO</option></select>

      <div class="mb-3">
        <div class="form-label">Why PEO → PLO?</div>
        <div id="peo_plo_logic" class="logic-box">—</div>
      </div>

      <div>
        <div><strong>PEO:</strong> <span id="peo_statement" class="muted">—</span></div>
        <div><strong>PLO:</strong> <span id="plo_statement" class="muted">—</span></div>
        <div><strong>Indicator:</strong> <span id="plo_indicator" class="muted">—</span></div>
      </div>
    </div>

    <!-- 3) Smart CLO Builder (main) -->
    <div class="card-box mb-3">
      <div class="row">
        <div class="col-12 col-xl-8">
          <h5 class="mb-1">Smart CLO Builder</h5>

          <div class="muted mb-2">
  <strong>Step 3:</strong> Construct a measurable Course Learning Outcome (CLO)
  using Bloom’s Taxonomy, appropriate verbs, and content focus.
</div>

          <div class="muted mb-2">Create measurable course learning outcomes quickly</div>

          <ul class="nav nav-tabs mb-3" id="tabNav" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#builderTab">Builder</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#variantsTab">Variants</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#assessmentTab">Assessment</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#historyTab">History</button></li>
          </ul>

          <div class="tab-content">
            <!-- BUILDER -->
            <div class="tab-pane fade show active" id="builderTab">
              <div class="row g-3">
                <div class="col-md-6">
  <label class="form-label">Bloom</label>
  <select id="bloom" class="form-select">
    <option value="">Select Bloom</option>
  </select>

  <!-- Bloom description (UI only) -->
  <div id="bloom_desc" class="muted mt-1" style="font-size:0.85rem;">
    Select a Bloom level to see its description.
  </div>
</div>


                <div class="col-md-6">
                  <label class="form-label">Verb</label>
                  <select id="verb" class="form-select"><option value="">Select Verb</option></select>
                </div> 
                
                <div class="col-md-6">
                  <label class="form-label">Field (topic area)</label>
                  <select id="field" class="form-select">
                    <option value="" selected>— Select Field —</option>
                    <option>Computer Science</option>
                    <option>Medical & Health</option>
                    <option>Engineering</option>
                    <option>Social Sciences</option>
                    <option>Education</option>
                    <option>Business</option>
                    <option>Arts & Humanities</option>
                  </select>
                  <div id="content_suggestions" class="mt-2"></div>
                </div>

                <div class="col-12">
                  <label class="form-label">Content (topic / object)</label>
                  <input id="content" class="form-control" placeholder="e.g., interpret ECG waveforms">
                </div>

                <div class="col-12 d-flex gap-2 align-items-center">
                  <button id="generateBtn" class="btn btn-primary"><i class="bi bi-magic me-1"></i> Generate CLO</button>
                  <button id="copyBtn" class="btn btn-outline-secondary"><i class="bi bi-clipboard me-1"></i> Copy</button>
                  <div id="busy" class="muted" style="display:none">Generating…</div>
                </div>

                <div id="cloCard" class="col-12 card-box" style="display:none; margin-top:12px;">
                  <h6 class="mb-2">Generated CLO</h6>
                  <div id="clo_text" style="line-height:1.4; font-weight:600;"></div>

                  <div class="mt-3">
                    <button id="toggleVariants" class="btn btn-outline-secondary btn-sm">Show variants</button>
                    <div id="variantsPanel" style="display:none; margin-top:10px;"></div>
                  </div>

                  <div class="mt-3 d-flex gap-2">
                    <button id="downloadBtn" class="btn btn-success"><i class="bi bi-download me-1"></i> Download CLO</button>
                    <button id="downloadRubricBtn" class="btn btn-outline-secondary"><i class="bi bi-file-earmark-text me-1"></i> Download Rubric</button>
                  </div>
                </div>

              </div>
            </div>

            <!-- VARIANTS -->
            <div class="tab-pane fade" id="variantsTab">
              <div id="variants_list" class="muted">Variants will appear after generating a CLO.</div>
            </div>

            <!-- ASSESSMENT -->
            <div class="tab-pane fade" id="assessmentTab">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="card-box">
                    <h6>Assessment methods</h6>
                    <div id="assess_list" class="muted">—</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card-box">
                    <h6>Suggested evidence</h6>
                    <div id="evidence_list" class="muted">—</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- HISTORY -->
            <div class="tab-pane fade" id="historyTab">
              <div class="card-box">
                <h6>Recent generation</h6>
                <div id="history_list" class="muted">Server-side history not enabled.</div>
              </div>
            </div>

          </div>
        </div>

        <!-- RIGHT SIDEBAR: Mapping metadata -->
        <div class="col-12 col-xl-4">
          <div class="card-box mb-3">
            <div class="form-label">Mapping metadata</div>
            <div class="meta-item"><strong>SC Code:</strong><div id="sc_code" class="muted">—</div></div>
            <div class="meta-item"><strong>SC Description:</strong><div id="sc_desc" class="muted">—</div></div>
            <div class="meta-item"><strong>VBE:</strong><div id="vbe" class="muted">—</div></div>
            <div class="meta-item"><strong>Domain:</strong><div id="domain" class="muted">—</div></div>
            <div class="meta-item"><strong>Condition:</strong><div id="condition" class="muted">—</div></div>
            <div class="meta-item"><strong>Criterion:</strong><div id="criterion" class="muted">—</div></div>
          </div>

          <div class="card-box">
            <div class="form-label">Quick content suggestions</div>
            <div id="content_suggestions_right"></div>
          </div>
        </div>

      </div>
    </div>

    <footer>© 2025 • Assoc Prof Dr Hazwani Ahmad Yusof @ Hanafi — Universiti Sains Malaysia (USM)</footer>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App JS -->
  <script>
/* =========================
   SHORT HELPER
========================= */
const $ = id => document.getElementById(id);

/* =========================
   DOM REFERENCES
========================= */
const profileSel = $('profile');
const levelSel = $('level');
const iegSel = $('ieg');
const peoSel = $('peo');
const ploSel = $('plo');

const bloomSel = $('bloom');
const verbSel = $('verb');
const fieldSel = $('field');
const contentInput = $('content');

const iegLogicBox = $('ieg_peo_logic');
const peoPloLogicBox = $('peo_plo_logic');

const peoStatementEl = $('peo_statement');
const ploStatementEl = $('plo_statement');
const ploIndicatorEl = $('plo_indicator');

const scCodeEl = $('sc_code');
const scDescEl = $('sc_desc');
const vbeEl = $('vbe');
const domainEl = $('domain');
const conditionEl = $('condition');
const criterionEl = $('criterion');

const generateBtn = $('generateBtn');
const copyBtn = $('copyBtn');
const busyEl = $('busy');
const cloCard = $('cloCard');
const cloText = $('clo_text');
const toggleVariantsBtn = $('toggleVariants');
const variantsPanel = $('variantsPanel');
const variants_list = $('variants_list');

const assessList = $('assess_list');
const evidenceList = $('evidence_list');

const downloadBtn = $('downloadBtn');
const downloadRubricBtn = $('downloadRubricBtn');
const darkToggle = $('darkToggle');

const contentSuggestionsEl = $('content_suggestions');
const contentSuggestionsRight = $('content_suggestions_right');

const bloomDescEl = $('bloom_desc');

/* =========================
   STATE
========================= */
let MAP = {};
let LAST_CLO = null;

/* =========================
   BLOOM DESCRIPTIONS
========================= */
const BLOOM_DESC = {
  /* Cognitive */
  remember: "Recall facts, terms, or basic concepts.",
  understand: "Explain ideas or concepts in your own words.",
  apply: "Use knowledge in new but familiar situations.",
  analyze: "Break information into parts and examine relationships.",
  evaluate: "Make judgments based on criteria or standards.",
  create: "Produce new or original work by combining elements.",

  /* Affective */
  receiving: "Willingness to attend to or be aware of stimuli.",
  responding: "Active participation by responding or reacting.",
  valuing: "Demonstrating commitment or belief in a value.",
  organization: "Integrating values into a consistent value system.",
  characterization: "Acting consistently according to internalised values.",

  /* Psychomotor */
  perception: "Use sensory cues to guide motor activity.",
  set: "Demonstrate readiness to perform a skill.",
  "guided response": "Perform skill under guidance or imitation.",
  mechanism: "Carry out skill with confidence and proficiency.",
  "complex overt response": "Perform complex skills smoothly and accurately.",
  adaptation: "Modify learned skills to suit new situations.",
  origination: "Create new movement patterns or procedures."
};

/* =========================
   ASSESSMENT & EVIDENCE
========================= */
const ASSESSMENT_MAP = {
  remember: {
    assessments: ["MCQ","True/False","Matching","Short-answer","Online quiz"],
    evidence: ["Exam paper","Answer key","LMS report"]
  },
  understand: {
    assessments: ["Short essay","Concept map","Oral questioning","Viva"],
    evidence: ["Essay script","Rubric","Viva sheet"]
  },
  apply: {
    assessments: ["Problem-solving","Simulation","Practical task","Short case"],
    evidence: ["Lab report","Checklist","Assessor notes"]
  },
  analyze: {
    assessments: ["Case study","Long case","Data analysis"],
    evidence: ["Analytical report","Annotated script"]
  },
  evaluate: {
    assessments: ["Critical review","Debate","Viva"],
    evidence: ["Review paper","Peer evaluation","Reflection"]
  },
  create: {
    assessments: ["Project","Capstone","Research proposal"],
    evidence: ["Project report","Prototype","Supervisor feedback"]
  },

  /* Affective */
  receiving: {
    assessments: ["Observation","Attendance-based task"],
    evidence: ["Observation checklist","Attendance record"]
  },
  responding: {
    assessments: ["Class participation","Reflective journal","Forum discussion"],
    evidence: ["Participation rubric","Reflection log"]
  },
  valuing: {
    assessments: ["Reflective essay","Ethics case reflection"],
    evidence: ["Reflection essay","Rubric","Assessor comments"]
  },
  organization: {
    assessments: ["Portfolio","Ethical reasoning task"],
    evidence: ["Portfolio artefact","Evaluation rubric"]
  },
  characterization: {
    assessments: ["Professional behaviour assessment","WBA"],
    evidence: ["Supervisor evaluation","Professional logbook"]
  },

  /* Psychomotor */
  perception: {
    assessments: ["Skill observation"],
    evidence: ["Observation checklist"]
  },
  set: {
    assessments: ["Equipment setup","Readiness check"],
    evidence: ["Setup checklist"]
  },
  "guided response": {
    assessments: ["Supervised practice","OSPE"],
    evidence: ["Skills checklist"]
  },
  mechanism: {
    assessments: ["OSCE","Practical exam"],
    evidence: ["Scoring rubric","Examiner sheet"]
  },
  "complex overt response": {
    assessments: ["Integrated task","Long case","Short case"],
    evidence: ["Performance rubric","Video evidence"]
  },
  adaptation: {
    assessments: ["Adaptive scenario"],
    evidence: ["Assessor report"]
  },
  origination: {
    assessments: ["Innovation project"],
    evidence: ["Project artefact","Evaluation rubric"]
  }
};

/* =========================
   NORMALISE BLOOM
========================= */
function normaliseBloomKey(value) {
  if (!value) return "";
  let v = value.toLowerCase().trim();
  v = v.replace(/\(.*?\)/g, "").trim();

  const MAP = {
    receive: "receiving",
    receiving: "receiving",
    respond: "responding",
    responding: "responding",
    value: "valuing",
    valuing: "valuing"
  };

  return MAP[v] || v;
}

/* =========================
   THEME TOGGLE
========================= */
darkToggle.addEventListener('click', () => {
  const curr = document.body.getAttribute('data-theme') || 'light';
  const next = curr === 'light' ? 'dark' : 'light';
  document.body.setAttribute('data-theme', next);
  darkToggle.innerHTML = next === 'dark'
    ? '<i class="bi bi-sun"></i> Light'
    : '<i class="bi bi-moon"></i> Dark';
});

/* =========================
   LOAD MAPPING
========================= */
async function loadMapping() {
  const res = await fetch('/api/mapping');
  MAP = await res.json();

  iegSel.innerHTML = '<option value="">Select IEG</option>';
  (MAP.IEGs || []).forEach(i => iegSel.add(new Option(i, i)));

  ploSel.innerHTML = '<option value="">Select PLO</option>';
}

/* =========================
   BLOOM CHANGE (ONLY ONE)
========================= */
bloomSel.addEventListener("change", async () => {
  const raw = bloomSel.value;
  const key = normaliseBloomKey(raw);
  const plo = ploSel.value;

  console.log("BLOOM:", raw, "→", key);

  /* Description */
  bloomDescEl.textContent =
    BLOOM_DESC[key] || "Select a Bloom level to see its description.";

  /* Assessment + Evidence */
  const ae = ASSESSMENT_MAP[key];
  if (ae) {
    assessList.innerHTML =
      "<ul>" + ae.assessments.map(a => `<li>${a}</li>`).join("") + "</ul>";
    evidenceList.innerHTML =
      "<ul>" + ae.evidence.map(e => `<li>${e}</li>`).join("") + "</ul>";
  } else {
    assessList.innerHTML = "—";
    evidenceList.innerHTML = "—";
  }

  /* Backend verbs + meta */
  if (!plo || !key) return;

  const vres = await fetch(`/api/get_verbs/${encodeURIComponent(plo)}/${encodeURIComponent(key)}?profile=${encodeURIComponent(profileSel.value)}`);
  const verbs = await vres.json();
  verbSel.innerHTML = '<option value="">Select Verb</option>';
  (verbs || []).forEach(v => verbSel.add(new Option(v, v)));

  const mres = await fetch(`/api/get_meta/${encodeURIComponent(plo)}/${encodeURIComponent(key)}?profile=${encodeURIComponent(profileSel.value)}`);
  const meta = await mres.json();

  scCodeEl.textContent = meta.sc_code || '—';
  scDescEl.textContent = meta.sc_desc || '—';
  vbeEl.textContent = meta.vbe || '—';
  domainEl.textContent = meta.domain || '—';
  conditionEl.textContent = meta.condition || '—';
  criterionEl.textContent = meta.criterion || '—';
});

    /* =========================
   IEG → PEO
========================= */
iegSel.addEventListener("change", async () => {
  const ieg = iegSel.value;

  peoSel.innerHTML = '<option value="">Select PEO</option>';
  ploSel.innerHTML = '<option value="">Select PLO</option>';

  iegLogicBox.textContent = "—";
  peoPloLogicBox.textContent = "—";
  peoStatementEl.textContent = "—";
  ploStatementEl.textContent = "—";
  ploIndicatorEl.textContent = "—";

  if (!ieg) return;

  try {
    const res = await fetch(`/api/get_peos/${encodeURIComponent(ieg)}`);
    const peos = await res.json();

    (peos || []).forEach(p =>
      peoSel.add(new Option(p, p))
    );
  } catch (e) {
    console.error("IEG → PEO error", e);
  }

  try {
    const logicRes = await fetch(`/api/logic/ieg_peo/${encodeURIComponent(ieg)}`);
    const txt = await logicRes.text();
    iegLogicBox.textContent = txt?.trim() || "—";
  } catch (e) {
    console.error("IEG logic error", e);
  }
});
    
/* =========================
   INIT
========================= */
(function init(){
  loadMapping();

  // Make field default to "— Select Field —"
  if (fieldSel) {
    fieldSel.value = "";
    fieldSel.selectedIndex = 0;
  }

  // Clear suggestions on page load
  if (contentSuggestionsEl) {
    contentSuggestionsEl.innerHTML = "";
  }
  if (contentSuggestionsRight) {
    contentSuggestionsRight.innerHTML = "";
  }

  // track page init
  logEvent('page_init', { page: 'generator' });
})();
  </script>
</body>
</html>  


    
