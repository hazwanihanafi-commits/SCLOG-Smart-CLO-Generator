<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SCLOG — Smart CLO Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap + icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Theme CSS -->
  <style>
    :root{
      --usm-purple:#6d28d9;
      --usm-purple-2:#8b5cf6;
      --bg-light:#f5f3ff;
      --card:#ffffff;
      --muted:#6c6480;
      --radius:14px;
      --shadow:0 10px 30px rgba(15,23,42,0.06);
    }
    body{margin:0;font-family:system-ui;background:var(--bg-light);color:#2a2344}
    .container-app{max-width:1200px;margin:18px auto 40px;padding:12px}
    .card-box{background:var(--card);border-radius:var(--radius);padding:16px;border:1px solid rgba(109,40,217,.1);box-shadow:var(--shadow);margin-bottom:16px}
    .brand{font-weight:900;font-size:1.2rem;background:linear-gradient(90deg,var(--usm-purple),var(--usm-purple-2));-webkit-background-clip:text;color:transparent}
    .subtitle{color:var(--muted);font-size:.95rem}
    label.form-label{font-weight:600;color:var(--muted)}
    .form-control,.form-select{border-radius:12px;padding:10px;background:#fbf8ff;border:1px solid rgba(109,40,217,.1)}
    .logic-box{background:#f7f2ff;padding:10px;border-radius:10px;min-height:56px}
    .btn{border-radius:12px;font-weight:700}
    .btn-primary{background:linear-gradient(90deg,var(--usm-purple),var(--usm-purple-2));border:none}
    .muted{color:var(--muted)}
    footer{text-align:center;color:var(--muted);font-size:.85rem;margin-top:20px}
  </style>
</head>

<body>
<div class="container-app">

  <!-- HEADER -->
  <div class="card-box d-flex justify-content-between align-items-center">
    <div>
      <div class="brand">SCLOG</div>
      <div class="subtitle">Smart Course Learning Outcome Generator — logic & mapping</div>
    </div>
  </div>

  <!-- STEP 1 -->
  <div class="card-box">
    <label class="form-label">Academic Profile</label>
    <select id="profile" class="form-select mb-2">
      <option value="">Select Academic Profile</option>
      <option value="health">Medical & Health</option>
      <option value="sc">Computer Science & IT</option>
      <option value="eng">Engineering & Technology</option>
      <option value="socs">Social Sciences</option>
      <option value="edu">Education</option>
      <option value="bus">Business & Management</option>
      <option value="arts">Arts & Humanities</option>
    </select>

    <label class="form-label">Programme Level</label>
    <select id="level" class="form-select">
      <option value="">Select Level</option>
      <option>Diploma</option>
      <option>Degree</option>
      <option>Master</option>
      <option>PhD</option>
    </select>
  </div>

  <!-- STEP 2 -->
  <div class="card-box">
    <label class="form-label">Institutional Educational Goal (IEG)</label>
    <select id="ieg" class="form-select mb-2">
      <option value="">Select IEG</option>
    </select>

    <label class="form-label">Programme Educational Objective (PEO)</label>
    <select id="peo" class="form-select mb-2">
      <option value="">Select PEO</option>
    </select>

    <div class="form-label">Why this IEG → PEO?</div>
    <div id="ieg_peo_logic" class="logic-box">—</div>
  </div>

  <!-- STEP 3 -->
  <div class="card-box">
    <label class="form-label">Programme Learning Outcome (PLO)</label>
    <select id="plo" class="form-select mb-2">
      <option value="">Select PLO</option>
    </select>

    <div class="form-label">Why PEO → PLO?</div>
    <div id="peo_plo_logic" class="logic-box mb-2">—</div>

    <div class="muted">
      <strong>PLO Statement:</strong> <span id="plo_statement">—</span><br/>
      <strong>Indicator:</strong> <span id="plo_indicator">—</span>
    </div>
  </div>

  <!-- STEP 4 -->
  <div class="card-box">
    <label class="form-label">Bloom Level</label>
    <select id="bloom" class="form-select mb-2">
      <option value="">Select Bloom</option>
    </select>

    <label class="form-label">Action Verb</label>
    <select id="verb" class="form-select mb-2">
      <option value="">Select Verb</option>
    </select>

    <label class="form-label">Content</label>
    <input id="content" class="form-control mb-2" placeholder="e.g., interpret ECG waveforms">

    <button id="generateBtn" class="btn btn-primary">Generate CLO</button>

    <div id="cloCard" class="card-box mt-3" style="display:none;">
      <h6>Generated CLO</h6>
      <div id="clo_text" style="font-weight:600;"></div>
    </div>
  </div>

  <footer>© 2025 • Universiti Sains Malaysia (USM)</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= API BASE ================= */
const API_BASE = window.location.origin;

/* ================= HELPERS ================= */
const $ = id => document.getElementById(id);

/* ================= DOM ================= */
const profileSel = $('profile');
const levelSel = $('level');
const iegSel = $('ieg');
const peoSel = $('peo');
const ploSel = $('plo');
const bloomSel = $('bloom');
const verbSel = $('verb');
const contentInput = $('content');

const iegLogicBox = $('ieg_peo_logic');
const peoPloLogicBox = $('peo_plo_logic');
const ploStatementEl = $('plo_statement');
const ploIndicatorEl = $('plo_indicator');
const cloCard = $('cloCard');
const cloText = $('clo_text');
const generateBtn = $('generateBtn');

/* ================= INIT ================= */
async function loadMapping(){
  const res = await fetch(`${API_BASE}/api/mapping`);
  const data = await res.json();
  iegSel.innerHTML = '<option value="">Select IEG</option>';
  (data.IEGs || []).forEach(i => iegSel.add(new Option(i,i)));
}
loadMapping();

/* ================= IEG → PEO ================= */
iegSel.addEventListener('change', async () => {
  const ieg = iegSel.value;
  peoSel.innerHTML = '<option value="">Select PEO</option>';
  if(!ieg) return;

  const r = await fetch(`${API_BASE}/api/get_peos/${encodeURIComponent(ieg)}`);
  const peos = await r.json();
  peos.forEach(p => peoSel.add(new Option(p,p)));

  const logic = await fetch(`${API_BASE}/api/logic/ieg_peo/${encodeURIComponent(ieg)}`).then(r=>r.text());
  iegLogicBox.textContent = logic || '—';
});

/* ================= PEO → PLO ================= */
peoSel.addEventListener('change', async () => {
  const peo = peoSel.value;
  ploSel.innerHTML = '<option value="">Select PLO</option>';
  if(!peo) return;

  const r = await fetch(`${API_BASE}/api/get_plos/${encodeURIComponent(peo)}`);
  const plos = await r.json();
  plos.forEach(p => ploSel.add(new Option(p,p)));
});

/* ================= PLO → BLOOM ================= */
ploSel.addEventListener('change', async () => {
  const plo = ploSel.value;
  bloomSel.innerHTML = '<option value="">Select Bloom</option>';
  if(!plo) return;

  const r = await fetch(`${API_BASE}/api/get_blooms/${encodeURIComponent(plo)}?profile=${encodeURIComponent(profileSel.value)}`);
  const blooms = await r.json();
  blooms.forEach(b => bloomSel.add(new Option(b,b)));

  const stmt = await fetch(`${API_BASE}/api/get_statement/${encodeURIComponent(levelSel.value || 'Degree')}/PLO/${encodeURIComponent(plo)}`).then(r=>r.json());
  ploStatementEl.textContent = stmt || '—';
});

/* ================= BLOOM → VERB ================= */
bloomSel.addEventListener('change', async () => {
  const r = await fetch(`${API_BASE}/api/get_verbs/${encodeURIComponent(ploSel.value)}/${encodeURIComponent(bloomSel.value)}?profile=${encodeURIComponent(profileSel.value)}`);
  const verbs = await r.json();
  verbSel.innerHTML = '<option value="">Select Verb</option>';
  verbs.forEach(v => verbSel.add(new Option(v,v)));
});

/* ================= GENERATE ================= */
generateBtn.addEventListener('click', async () => {
  const fd = new FormData();
  fd.append('profile', profileSel.value);
  fd.append('level', levelSel.value);
  fd.append('plo', ploSel.value);
  fd.append('bloom', bloomSel.value);
  fd.append('verb', verbSel.value);
  fd.append('content', contentInput.value);

  const res = await fetch(`${API_BASE}/generate`, { method:'POST', body: fd });
  const data = await res.json();
  cloText.textContent = data.clo;
  cloCard.style.display = 'block';
});
</script>
</body>
</html>
