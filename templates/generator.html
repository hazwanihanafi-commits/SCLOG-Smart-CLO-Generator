<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>SCLOG — Smart CLO Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

<style>
body{background:#f5f3ff;font-family:system-ui}
.card-box{background:#fff;border-radius:14px;padding:16px;border:1px solid #e5e7eb}
.logic-box{background:#f7f2ff;border-radius:10px;padding:12px}
.bloom-tag{font-size:.75rem;font-weight:800;background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px}
.small-muted{font-size:.85rem;color:#6b7280}
</style>
</head>

<body>
<div class="container my-4">

<!-- ================= HEADER ================= -->
<div class="card-box mb-3">
  <h3 class="fw-bold text-purple">
    <i class="bi bi-stars"></i> SCLOG
  </h3>
  <div class="text-muted">Smart Course Learning Outcome Generator</div>
</div>

<!-- ================= STEP 1 ================= -->
<div class="card-box mb-3">
<h5>STEP 1 · Programme Context</h5>

<label class="form-label">Programme Name</label>
<input id="programmeName" class="form-control mb-2"
 placeholder="e.g. Bachelor of Exercise Science">

<label class="form-label">Programme Level</label>
<select id="level" class="form-select mb-2">
  <option value="">Select</option>
  <option>Diploma</option>
  <option>Degree</option>
  <option>Master</option>
  <option>PhD</option>
</select>

<label class="form-label">Institutional Educational Goal (IEG)</label>
<textarea id="ieg_text" class="form-control mb-2"
 placeholder="Paste official IEG here"></textarea>

<button id="generatePEO" class="btn btn-primary mt-2">
Generate PEO
</button>

<div id="peoSuggestions" class="mt-3"></div>

<label class="form-label mt-3">Select PEO</label>
<select id="peo" class="form-select"></select>

<div class="mt-2">
<strong>PEO Indicator:</strong>
<div id="peo_indicator" class="small-muted">—</div>
</div>
</div>

<!-- ================= STEP 2 ================= -->
<div class="card-box mb-3">
<h5>STEP 2 · Programme Learning Outcomes (PLO)</h5>

<label class="form-label">Mapped PLO</label>
<select id="plo" class="form-select"></select>

<div class="mt-2">
<strong>PLO Statement:</strong>
<div id="plo_statement" class="small-muted">—</div>

<strong>Indicator:</strong>
<div id="plo_indicator" class="small-muted">—</div>
</div>
</div>

<!-- ================= STEP 3 ================= -->
<div class="card-box mb-3">
<div class="d-flex align-items-center gap-2">
<h5 class="mb-0">STEP 3 · Smart CLO Builder</h5>
<span id="bloomTag" class="bloom-tag">—</span>
</div>

<label class="form-label mt-2">Bloom Level</label>
<select id="bloom" class="form-select"></select>

<div id="bloom_desc" class="small-muted mt-1">
Select a Bloom level to see its description.
</div>

<label class="form-label mt-2">Action Verb</label>
<select id="verb" class="form-select"></select>

<label class="form-label mt-2">Content / Focus</label>
<input id="content" class="form-control"
 placeholder="e.g. ECG interpretation">

<button id="generateBtn" class="btn btn-success mt-3">
Generate CLO
</button>

<div id="cloCard" class="mt-3" style="display:none">
<div class="logic-box">
<strong>CLO</strong>
<div id="clo_text"></div>
</div>
</div>
</div>

</div>

<script>
/* =================================================
   HELPERS
================================================= */
const $ = id => document.getElementById(id);

/* =================================================
   CONSTANTS
================================================= */
const BLOOM_DESC = {
 remember:"Recall facts or concepts.",
 understand:"Explain ideas in own words.",
 apply:"Use knowledge in practice.",
 analyze:"Break information into parts.",
 evaluate:"Make judgments using criteria.",
 create:"Produce new or original work.",

 receiving:"Awareness and willingness.",
 responding:"Active participation.",
 valuing:"Commitment to values.",
 organization:"Integrating values.",
 characterization:"Consistent value-based behaviour.",

 perception:"Use sensory cues.",
 set:"Readiness to act.",
 "guided response":"Perform under guidance.",
 mechanism:"Perform skill confidently.",
 adaptation:"Modify skills.",
 origination:"Create new patterns."
};

const VBE_BY_LEVEL = {
  Diploma:{
    bloom:{
      C:["remember","understand","apply"],
      A:["receiving","responding"],
      P:["perception","set","guided response"]
    },
    values:["discipline","responsibility"],
    focus:"work readiness and ethical conduct"
  },

  Degree:{
    bloom:{
      C:["remember","understand","apply","analyze","evaluate"],
      A:["responding","valuing"],
      P:["guided response","mechanism"]
    },
    values:["integrity","justice"],
    focus:"professional practice and societal responsibility"
  },

  Master:{
    bloom:{
      C:["analyze","evaluate","create"],
      A:["valuing","organization"],
      P:["mechanism","adaptation"]
    },
    values:["wisdom","accountability"],
    focus:"advanced professional judgement and leadership"
  },

  PhD:{
    bloom:{
      C:["create"],
      A:["characterization"],
      P:["adaptation","origination"]
    },
    values:["truth","global responsibility"],
    focus:"knowledge creation and ethical leadership"
  }
};

  function bloomDomainTag(bloom, level){
  const map = VBE_BY_LEVEL[level]?.bloom || {};
  const b = bloom.toLowerCase();

  if(map.C?.includes(b)) return "C";
  if(map.A?.includes(b)) return "A";
  if(map.P?.includes(b)) return "P";
  return "—";
}
  
const PEO_INDICATORS = {
 PEO1:["Strong disciplinary competence"],
 PEO2:["Effective communication"],
 PEO3:["Leadership & lifelong learning"],
 PEO4:["Innovation & entrepreneurship"],
 PEO5:["Ethical professionalism"]
};

/* =================================================
   STEP 1 – PEO
================================================= */
function generatePEO(name){
 return [
  {code:"PEO1",text:`Graduates of the ${name} demonstrate strong disciplinary knowledge.`,
   plos:["PLO1","PLO2"],indicator:PEO_INDICATORS.PEO1},
  {code:"PEO2",text:`Graduates of the ${name} communicate effectively.`,
   plos:["PLO3","PLO4"],indicator:PEO_INDICATORS.PEO2}
 ];
}

$("generatePEO").onclick=()=>{
 const name=$("programmeName").value;
 if(!name){alert("Enter programme name");return;}

 const peos=generatePEO(name);
 $("peoSuggestions").innerHTML="";
 peos.forEach(p=>{
  $("peoSuggestions").innerHTML+=`
   <div class="logic-box mb-2">
    <strong>${p.code}</strong><br>${p.text}
   </div>`;
 });
 $("peo").innerHTML='<option value="">Select</option>';
 peos.forEach(p=>$("peo").add(new Option(p.code,p.code)));
 $("peo").dataset.map=JSON.stringify(peos);
};

$("peo").onchange=()=>{
 const peos=JSON.parse($("peo").dataset.map||"[]");
 const p=peos.find(x=>x.code===$("peo").value);
 if(!p)return;
 $("peo_indicator").innerHTML="<ul>"+p.indicator.map(i=>`<li>${i}</li>`).join("")+"</ul>";
 $("plo").innerHTML='<option value="">Select</option>';
 p.plos.forEach(x=>$("plo").add(new Option(x,x)));
};

/* =================================================
   STEP 2 – PLO
================================================= */
$("plo").onchange=async()=>{
 const plo=$("plo").value;
 if(!plo)return;

 $("plo_statement").textContent=
  await fetch(`/api/get_statement/Degree/PLO/${plo}`).then(r=>r.json());
 $("plo_indicator").textContent="Achievement demonstrated in assessment.";

 const blooms=await fetch(`/api/get_blooms/${plo}`).then(r=>r.json());
 $("bloom").innerHTML='<option value="">Select</option>';
 blooms.forEach(b=>$("bloom").add(new Option(b,b)));
};

/* =================================================
   STEP 3 – BLOOM
================================================= */
$("bloom").onchange = async () => {
  const bloom = $("bloom").value;
  const level = $("level").value || "Degree";
  const plo = $("plo").value;

  if(!bloom) return;

  const tag = bloomDomainTag(bloom, level);
  $("bloomTag").textContent = `${tag} · ${bloom}`;

  $("bloom_desc").innerHTML = `
    <strong>${bloom.toUpperCase()}</strong><br>
    ${BLOOM_DESC[bloom.toLowerCase()] || "—"}<br><br>
    <strong>Domain:</strong> ${tag}<br>
    <strong>Justification:</strong>
    Appropriate for ${level} level aligned with
    ${VBE_BY_LEVEL[level].focus}.
  `;

  if(!plo) return;

  const verbs = await fetch(`/api/get_verbs/${plo}/${bloom}`).then(r=>r.json());
  fillSelect($("verb"), verbs);
};

/* =================================================
   GENERATE CLO
================================================= */
$("generateBtn").onclick=async()=>{
 const fd=new FormData();
 fd.append("plo",$("plo").value);
 fd.append("bloom",$("bloom").value);
 fd.append("verb",$("verb").value);
 fd.append("content",$("content").value);

 const d=await fetch("/generate",{method:"POST",body:fd}).then(r=>r.json());
 $("clo_text").textContent=d.clo;
 $("cloCard").style.display="block";
};
</script>
</body>
</html>
