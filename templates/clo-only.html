<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SCLOG — CLO Only Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-4">

<div class="container" style="max-width:720px">

  <h3 class="mb-4">⚡ CLO Only Generator</h3>

  <!-- PLO -->
  <div class="mb-3">
    <label class="form-label">Programme Learning Outcome (PLO)</label>
    <select id="plo" class="form-select">
      <option value="">Select PLO</option>
      <option>PLO1</option>
      <option>PLO2</option>
      <option>PLO3</option>
      <option>PLO4</option>
      <option>PLO5</option>
      <option>PLO6</option>
      <option>PLO7</option>
      <option>PLO8</option>
      <option>PLO9</option>
      <option>PLO10</option>
      <option>PLO11</option>
    </select>
  </div>

  <!-- Bloom -->
  <div class="mb-3">
    <label class="form-label">Bloom Level</label>
    <select id="bloom" class="form-select">
      <option value="">Select Bloom</option>
    </select>
  </div>

  <!-- Verb -->
  <div class="mb-3">
    <label class="form-label">Action Verb</label>
    <select id="verb" class="form-select">
      <option value="">Select Verb</option>
    </select>
  </div>

  <!-- Content -->
  <div class="mb-3">
    <label class="form-label">Content / Learning Focus</label>
    <input id="content" class="form-control"
      placeholder="e.g. ECG waveform abnormalities">
  </div>

  <button id="generateBtn" class="btn btn-primary w-100 mb-3">
    Generate CLO
  </button>

  <!-- CLO OUTPUT -->
  <div id="cloCard" class="card p-3 mb-3" style="display:none">
    <strong>Generated CLO</strong>
    <div id="clo_text" class="mt-2"></div>
  </div>

  <!-- VARIANTS -->
  <div class="mb-3">
    <h6>Variants</h6>
    <div id="variants_list" class="text-muted"></div>
  </div>

  <!-- ASSESSMENT -->
  <div class="mb-3">
    <h6>Suggested Assessments</h6>
    <div id="assess_list" class="text-muted"></div>
  </div>

  <!-- EVIDENCE -->
  <div class="mb-3">
    <h6>Suggested Evidence</h6>
    <div id="evidence_list" class="text-muted"></div>
  </div>

  <button onclick="window.location='/download'" class="btn btn-success w-100">
    Download CLO (Excel)
  </button>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const $ = id => document.getElementById(id);

  const ploSel   = $("plo");
  const bloomSel = $("bloom");
  const verbSel  = $("verb");
  const content  = $("content");

  const cloCard  = $("cloCard");
  const cloText  = $("clo_text");

  const variantsList = $("variants_list");
  const assessList   = $("assess_list");
  const evidenceList = $("evidence_list");

  /* ---------------------------
     PLO → BLOOM
  --------------------------- */
  ploSel.addEventListener("change", async () => {
    bloomSel.innerHTML = `<option value="">Select Bloom</option>`;
    verbSel.innerHTML  = `<option value="">Select Verb</option>`;

    if (!ploSel.value) return;

    const res = await fetch(`/api/get_blooms/${ploSel.value}`);
    const blooms = await res.json();

    blooms.forEach(b => bloomSel.add(new Option(b, b)));
  });

  /* ---------------------------
     BLOOM → VERB
  --------------------------- */
  bloomSel.addEventListener("change", async () => {
    verbSel.innerHTML = `<option value="">Select Verb</option>`;
    if (!bloomSel.value || !ploSel.value) return;

    const res = await fetch(`/api/get_verbs/${ploSel.value}/${bloomSel.value}`);
    const verbs = await res.json();

    verbs.forEach(v => verbSel.add(new Option(v, v)));
  });

  /* ---------------------------
     GENERATE CLO
  --------------------------- */
  $("generateBtn").addEventListener("click", async () => {

    if (!ploSel.value || !bloomSel.value || !verbSel.value || !content.value.trim()) {
      alert("Please complete all fields.");
      return;
    }

    const fd = new FormData();
    fd.append("plo", ploSel.value);
    fd.append("bloom", bloomSel.value);
    fd.append("verb", verbSel.value);
    fd.append("content", content.value.trim());

    const res = await fetch("/generate", { method:"POST", body: fd });
    const data = await res.json();

    cloText.innerText = data.clo;
    cloCard.style.display = "block";

    variantsList.innerHTML =
      Object.entries(data.variants || {})
        .map(([k,v]) => `<p><strong>${k}:</strong> ${v}</p>`)
        .join("");

    assessList.innerHTML =
      "<ul>" + (data.assessments || []).map(a => `<li>${a}</li>`).join("") + "</ul>";

    evidenceList.innerHTML =
      Object.entries(data.evidence || {})
        .map(([k,v]) => `<div><strong>${k}</strong>: ${v.join(", ")}</div>`)
        .join("");
  });

});
</script>

</body>
</html>
