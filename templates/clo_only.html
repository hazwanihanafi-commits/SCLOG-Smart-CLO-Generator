<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SCLOG — CLO Construction (Quick Mode)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body { background:#f4f6f9; }
.app-header {
  background:linear-gradient(135deg,#0d6efd,#084298);
  color:#fff; padding:14px 0;
}
.app-header-inner {
  max-width:960px; margin:auto;
  display:flex; justify-content:space-between; align-items:center;
  padding:0 16px;
}
.card-box {
  background:#fff; border-radius:14px;
  padding:22px; box-shadow:0 12px 28px rgba(0,0,0,.08);
  margin-bottom:20px;
}
.info-box {
  background:#f7f8fc; border-left:4px solid #0d6efd;
  padding:14px; border-radius:8px;
}
.warn-box {
  background:#fff3cd; border-left:4px solid #f0ad4e;
  padding:10px; border-radius:6px; font-size:.85rem;
}
.muted { color:#6c757d; }
</style>
</head>

<body>

<header class="app-header">
  <div class="app-header-inner">
    <div>
      <strong>✨ SCLOG</strong><br>
      <small>Smart Course Learning Outcome Generator</small>
    </div>
    <a href="/" class="btn btn-outline-light btn-sm">← Back to Workflow</a>
  </div>
</header>

<div class="container my-4" style="max-width:960px">

<!-- INPUT -->
<div class="card-box">
<h5>⚡ CLO Construction (Quick Mode)</h5>

<div class="mb-3">
<label class="form-label">Programme Level</label>
<select id="level" class="form-select">
  <option value="">Select Level</option>
  <option>Diploma</option>
  <option>Degree</option>
  <option>Master</option>
  <option>PhD</option>
</select>
</div>

<div class="mb-3">
<label class="form-label">Programme Learning Outcome (PLO)</label>
<select id="plo" class="form-select">
  <option value="">Select PLO</option>
  <option>PLO1</option><option>PLO2</option><option>PLO3</option>
  <option>PLO4</option><option>PLO5</option><option>PLO6</option>
  <option>PLO7</option><option>PLO8</option><option>PLO9</option>
  <option>PLO10</option><option>PLO11</option>
</select>
</div>

<div id="ploInfo" class="info-box mb-3" style="display:none">
  <strong id="ploTitle"></strong>
  <div id="ploDesc" class="mt-1"></div>
  <div class="mt-2" style="font-size:.85rem">
    <strong>SC:</strong> <span id="ploSC"></span><br>
    <strong>VBE:</strong> <span id="ploVBE"></span>
  </div>
</div>

<div class="mb-3">
<label class="form-label">Bloom Level</label>
<select id="bloom" class="form-select">
  <option value="">Select Bloom</option>
</select>
<div id="bloomWarn" class="warn-box mt-2" style="display:none"></div>
<div id="bloomDesc" class="muted mt-2" style="font-size:.85rem"></div>
<div id="cloExample" class="muted mt-1" style="font-size:.85rem"></div>
</div>

<div class="mb-3">
<label class="form-label">Action Verb</label>
<select id="verb" class="form-select">
  <option value="">Select Verb</option>
</select>
</div>

<div class="mb-3">
<label class="form-label">Content / Learning Focus</label>
<input id="content" class="form-control" placeholder="e.g. exercise metabolism">
</div>

<button id="generateBtn" class="btn btn-primary w-100">Generate CLO</button>
</div>

<!-- OUTPUT -->
<div id="cloCard" class="card-box" style="display:none">
<h6>Generated CLO</h6>
<div id="cloText" class="fw-semibold"></div>

<hr>
<h6>Variants</h6>
<div id="variants"></div>

<hr>
<h6>Suggested Assessments</h6>
<div id="assessments"></div>

<h6 class="mt-2">Suggested Evidence</h6>
<div id="evidence"></div>

<div class="mt-3 d-flex gap-2">
<button class="btn btn-success" onclick="window.location='/download'">Download CLO</button>
<button class="btn btn-outline-secondary" onclick="window.location='/download_rubric'">Download Rubric</button>
</div>
</div>

</div>

<script>
const $ = id => document.getElementById(id);

/* =========================
   BLOOM DESCRIPTIONS
========================= */
const BLOOM_DESC = {
  remember:"Recall facts, terms, or basic concepts.",
  understand:"Explain ideas or concepts in your own words.",
  apply:"Use knowledge in new but familiar situations.",
  analyze:"Break information into parts and examine relationships.",
  evaluate:"Make judgments based on criteria or standards.",
  create:"Produce new or original work by combining elements.",

  receiving:"Willingness to attend to or be aware of stimuli.",
  responding:"Active participation by responding or reacting.",
  valuing:"Demonstrating commitment or belief in a value.",
  organization:"Integrating values into a consistent value system.",
  characterization:"Acting consistently according to internalised values.",

  perception:"Use sensory cues to guide motor activity.",
  set:"Demonstrate readiness to perform a skill.",
  "guided response":"Perform skill under guidance or imitation.",
  mechanism:"Carry out skill with confidence and proficiency.",
  "complex overt response":"Perform complex skills smoothly and accurately.",
  adaptation:"Modify learned skills to suit new situations.",
  origination:"Create new movement patterns or procedures."
};

/* =========================
   BLOOM RECOMMENDATION BY LEVEL
========================= */
const BLOOM_RECOMMENDATION_BY_LEVEL = {
  Diploma:{
    cognitive:["Remember","Understand","Apply"],
    affective:["Receiving","Responding"],
    psychomotor:["Perception","Set","Guided Response"]
  },
  Degree:{
    cognitive:["Understand","Apply","Analyze"],
    affective:["Responding","Valuing"],
    psychomotor:["Guided Response","Mechanism"]
  },
  Master:{
    cognitive:["Analyze","Evaluate","Create"],
    affective:["Valuing","Organization"],
    psychomotor:["Mechanism","Complex Overt Response","Adaptation"]
  },
  PhD:{
    cognitive:["Create"],
    affective:["Characterization"],
    psychomotor:["Adaptation","Origination"]
  }
};

/* =========================
   NORMALISE BLOOM
========================= */
function normaliseBloomKey(value){
  if(!value) return "";
  const v=value.toLowerCase();

  if(v.includes("receiv")) return "receiving";
  if(v.includes("respond")) return "responding";
  if(v.includes("valu")) return "valuing";
  if(v.includes("organiz")) return "organization";
  if(v.includes("character")) return "characterization";

  if(v.includes("remember")) return "remember";
  if(v.includes("understand")) return "understand";
  if(v.includes("apply")) return "apply";
  if(v.includes("analy")) return "analyze";
  if(v.includes("evaluate")) return "evaluate";
  if(v.includes("create")) return "create";

  if(v.includes("perception")) return "perception";
  if(v==="set") return "set";
  if(v.includes("guided")) return "guided response";
  if(v.includes("mechanism")) return "mechanism";
  if(v.includes("complex")) return "complex overt response";
  if(v.includes("adaptation")) return "adaptation";
  if(v.includes("origination")) return "origination";

  return "";
}


  /* =========================
   CLO EXAMPLE (ACADEMIC, MQA-ALIGNED)
========================= */
const CLO_EXAMPLE = {

  // ===== COGNITIVE =====
  remember:
    "Recall disciplinary knowledge with awareness of its professional and societal implications.",

  apply:
    "Apply disciplinary knowledge to practical situations using anticipatory thinking in an ethical manner.",

  analyze:
    "Analyse disciplinary knowledge by examining relationships and implications using anticipatory thinking to support ethical and professional decision-making.",

  evaluate:
    "Evaluate concepts and evidence using anticipatory thinking to justify decisions in accordance with ethical and professional standards.",

  create:
    "Design informed solutions by integrating disciplinary knowledge with anticipatory thinking, guided by ethics and professionalism.",

  // ===== AFFECTIVE =====
  receiving:
    "Demonstrate awareness and openness towards professional values and ethical responsibilities.",

  responding:
    "Respond constructively in learning activities by demonstrating collaboration and integrity in professional interactions.",

  valuing:
    "Demonstrate commitment to ethical principles and professional values in academic and professional contexts.",

  organization:
    "Organise personal and professional values into a coherent framework to guide ethical decision-making.",

  characterization:
    "Consistently demonstrate ethical judgement and professional conduct in complex situations.",

  // ===== PSYCHOMOTOR =====
  perception:
    "Perform tasks by recognising relevant sensory cues and safety considerations in professional practice.",

  set:
    "Demonstrate readiness to perform professional skills responsibly and ethically.",

  "guided response":
    "Perform professional skills under guidance while anticipating risks and ethical considerations.",

  mechanism:
    "Perform professional skills competently and confidently while anticipating long-term outcomes.",

  "complex overt response":
    "Perform complex professional skills smoothly and accurately in accordance with ethical standards.",

  adaptation:
    "Adapt professional procedures to new situations using anticipatory and strategic thinking.",

  origination:
    "Create new professional procedures or solutions guided by ethical foresight and professional responsibility."
};


  
/* =========================
   LOAD PLO MAP
========================= */
let PLO_MAP = {};
fetch("/static/data/plo_mapping.json")
  .then(r=>r.json())
  .then(d=>PLO_MAP=d);

/* =========================
   DOM
========================= */
const levelSel=$("level"), ploSel=$("plo"),
      bloomSel=$("bloom"), verbSel=$("verb");

/* =========================
   PLO CHANGE
========================= */
ploSel.onchange = async () => {

  const p=PLO_MAP[ploSel.value];
  if(!p){ $("ploInfo").style.display="none"; return; }

  $("ploInfo").style.display="block";
  $("ploTitle").innerText=`${ploSel.value} — ${p.title}`;
  $("ploDesc").innerText=p.refers_to;
  $("ploSC").innerText=`${p.sc_code} (${p.sc_description})`;
  $("ploVBE").innerText=p.vbe;

  const res=await fetch(`/api/get_blooms/${ploSel.value}`);
  const blooms=await res.json();

  const domain=p.domain.toLowerCase();
  const degree=levelSel.value;
  const recommended=BLOOM_RECOMMENDATION_BY_LEVEL[degree]?.[domain]||[];
  const allowed=recommended.map(b=>normaliseBloomKey(b));

  bloomSel.innerHTML='<option value="">Select Bloom</option>';

  blooms.forEach(b=>{
    const key=normaliseBloomKey(b);
    if(allowed.includes(key)){
      bloomSel.add(new Option(b,b));
    }
  });

  $("bloomWarn").style.display =
    bloomSel.options.length<=1 ? "block":"none";

  if(bloomSel.options.length<=1){
    $("bloomWarn").innerHTML=
      `⚠ No recommended <strong>${domain}</strong> Bloom level for <strong>${degree}</strong>.`;
  }
};

levelSel.onchange=()=>{ if(ploSel.value) ploSel.dispatchEvent(new Event("change")); };

/* =========================
   BLOOM CHANGE
========================= */
bloomSel.onchange=async()=>{
  const key=normaliseBloomKey(bloomSel.value);
  $("bloomDesc").innerText=BLOOM_DESC[key]||"";
 const contentText = $("content").value.trim() || "the relevant disciplinary content";

$("cloExample").innerHTML =
  CLO_EXAMPLE[key]
    ? `<strong>Example CLO (${bloomSel.value}):</strong><br>
       ${CLO_EXAMPLE[key].replace("disciplinary knowledge", contentText)}`
    : "";



  const res=await fetch(`/api/get_verbs/${ploSel.value}/${bloomSel.value}`);
  const verbs=await res.json();
  verbSel.innerHTML='<option value="">Select Verb</option>';
  verbs.forEach(v=>verbSel.add(new Option(v,v)));
};

/* =========================
   GENERATE CLO
========================= */
$("generateBtn").onclick=async()=>{
  const fd=new FormData();
  fd.append("level",levelSel.value);
  fd.append("plo",ploSel.value);
  fd.append("bloom",bloomSel.value);
  fd.append("verb",verbSel.value);
  fd.append("content",$("content").value.trim());

  const r=await fetch("/generate",{method:"POST",body:fd});
  const d=await r.json();

  $("cloCard").style.display="block";
  $("cloText").innerText=d.clo;

  $("variants").innerHTML=
    Object.entries(d.variants||{})
      .map(([k,v])=>`<div><strong>${k}:</strong> ${v}</div>`).join("");

  $("assessments").innerHTML=
    "<ul>"+(d.assessments||[]).map(a=>`<li>${a}</li>`).join("")+"</ul>";

  $("evidence").innerHTML=
    Object.entries(d.evidence||{})
      .map(([k,v])=>`<div><strong>${k}</strong>: ${v.join(", ")}</div>`).join("");
};
</script>

</body>
</html>
