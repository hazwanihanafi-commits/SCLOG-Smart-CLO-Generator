<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SCLOG — CLO Construction (Quick Mode)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { background:#f4f6f9; }

    .app-header {
      background:linear-gradient(135deg,#0d6efd,#084298);
      color:#fff; padding:14px 0;
    }
    .app-header-inner {
      max-width:960px; margin:auto;
      display:flex; justify-content:space-between; align-items:center;
      padding:0 16px;
    }
    .card-box {
      background:#fff; border-radius:14px;
      padding:22px; box-shadow:0 12px 28px rgba(0,0,0,.08);
      margin-bottom:20px;
    }
    .muted { color:#6c757d; }
    .info-box {
      background:#f7f8fc;
      border-left:4px solid #0d6efd;
      padding:14px;
      border-radius:8px;
    }
    .warn-box {
      background:#fff3cd;
      border-left:4px solid #f0ad4e;
      padding:10px;
      border-radius:6px;
      font-size:0.85rem;
    }
  </style>
</head>

<body>

<!-- HEADER -->
<header class="app-header">
  <div class="app-header-inner">
    <div>
      <strong>✨ SCLOG</strong><br>
      <small>Smart Course Learning Outcome Generator</small>
    </div>
    <a href="/app" class="btn btn-outline-light btn-sm">← Back to Workflow</a>
  </div>
</header>

<div class="container my-4" style="max-width:960px">

  <!-- INPUT CARD -->
  <div class="card-box">
    <h5 class="mb-3">⚡ CLO Construction (Quick Mode)</h5>

    <!-- DEGREE -->
    <div class="mb-3">
      <label class="form-label">Programme Level</label>
      <select id="degree" class="form-select">
        <option value="">Select Level</option>
        <option>Diploma</option>
        <option>Degree</option>
        <option>Master</option>
        <option>PhD</option>
      </select>
    </div>

    <!-- PLO -->
    <div class="mb-3">
      <label class="form-label">Programme Learning Outcome (PLO)</label>
      <select id="plo" class="form-select">
        <option value="">Select PLO</option>
        <option>PLO1</option><option>PLO2</option><option>PLO3</option>
        <option>PLO4</option><option>PLO5</option><option>PLO6</option>
        <option>PLO7</option><option>PLO8</option><option>PLO9</option>
        <option>PLO10</option><option>PLO11</option>
      </select>
    </div>

    <!-- PLO INFO -->
    <div id="ploInfoBox" class="info-box mb-3" style="display:none">
      <div class="fw-bold" id="ploTitle"></div>
      <div id="ploRefers" class="mt-1" style="font-size:.9rem"></div>

      <div class="mt-2" style="font-size:.85rem">
        <strong>SC:</strong> <span id="ploSC"></span> — <span id="ploSCDesc"></span>
      </div>
      <div class="mt-1" style="font-size:.85rem">
        <strong>VBE:</strong> <span id="ploVBE"></span>
      </div>
      <div class="mt-1" style="font-size:.85rem">
        <strong>SDGs:</strong> <span id="ploSDG"></span>
      </div>
    </div>

    <!-- BLOOM -->
    <div class="mb-3">
      <label class="form-label">Bloom Level</label>
      <select id="bloom" class="form-select">
        <option value="">Select Bloom</option>
      </select>

      <div id="bloomWarn" class="warn-box mt-2" style="display:none"></div>

      <div id="ploExampleBox" class="muted mt-2" style="display:none;font-size:.85rem"></div>
    </div>

    <!-- VERB -->
    <div class="mb-3">
      <label class="form-label">Action Verb</label>
      <select id="verb" class="form-select">
        <option value="">Select Verb</option>
      </select>
    </div>

    <!-- CONTENT -->
    <div class="mb-3">
      <label class="form-label">Content / Learning Focus</label>
      <input id="content" class="form-control" placeholder="e.g. exercise metabolism">
    </div>

    <button id="generateBtn" class="btn btn-primary w-100">Generate CLO</button>
  </div>

  <!-- OUTPUT -->
  <div id="cloCard" class="card-box" style="display:none">
    <h6>Generated CLO</h6>
    <div id="clo_text" class="fw-semibold"></div>

    <div class="mt-2 muted" id="cloJustification" style="font-size:.85rem"></div>

    <hr>
    <h6>Variants</h6>
    <div id="variantBox"></div>

    <hr>
    <h6>Suggested Assessments</h6>
    <div id="assessmentBox"></div>

    <h6 class="mt-2">Suggested Evidence</h6>
    <div id="evidenceBox"></div>

    <div class="mt-3 d-flex gap-2">
      <button id="downloadBtn" class="btn btn-success">Download CLO (Excel)</button>
      <button id="rubricBtn" class="btn btn-outline-secondary">Download Rubric</button>
    </div>
  </div>

</div>

<script>
const $ = id => document.getElementById(id);

const ploSel = $("plo");
const bloomSel = $("bloom");
const verbSel = $("verb");
const degreeSel = $("degree");

let PLO_MAP = {};
fetch("/static/data/plo_mapping.json")
  .then(r=>r.json())
  .then(d=>PLO_MAP=d);

// PLO examples by Bloom
const PLO_EXAMPLE_BY_BLOOM = {
  remember:"Recall disciplinary knowledge while recognising future professional implications.",
  analyze:"Analyse complex disciplinary issues using anticipatory and integrated thinking to support ethical and sustainable decision-making.",
  adaptation:"Adapt professional procedures strategically in response to changing contexts.",
  respond:"Respond constructively to professional situations by demonstrating ethical and collaborative awareness.",
  value:"Demonstrate commitment to ethical and sustainable professional practices.",
  organize:"Organise professional actions by considering interconnected systems and long-term implications.",
  characterize:"Consistently demonstrate ethical judgement and professional accountability."
};

// PLO change
ploSel.addEventListener("change",()=>{
  const p=PLO_MAP[ploSel.value];
  if(!p){ $("ploInfoBox").style.display="none"; return; }

  $("ploTitle").innerText=`${ploSel.value} — ${p.title}`;
  $("ploRefers").innerText=p.refers_to;
  $("ploSC").innerText=p.sc_code;
  $("ploSCDesc").innerText=p.sc_description;
  $("ploVBE").innerText=p.vbe;
  $("ploSDG").innerText=p.sdg.join(", ");

  $("ploInfoBox").style.display="block";

  fetch(`/api/get_blooms/${ploSel.value}`)
    .then(r=>r.json())
    .then(b=>{
      bloomSel.innerHTML='<option value="">Select Bloom</option>';
      b.forEach(x=>bloomSel.add(new Option(x,x)));
    });
});

// Bloom change
bloomSel.addEventListener("change",()=>{
  const p=PLO_MAP[ploSel.value];
  if(!p) return;

  const bloomKey=bloomSel.value.toLowerCase();

  // example PLO
  const ex=PLO_EXAMPLE_BY_BLOOM[bloomKey];
  if(ex){
    $("ploExampleBox").innerHTML=`<strong>Example PLO (${bloomSel.value}):</strong><br>${ex}`;
    $("ploExampleBox").style.display="block";
  } else $("ploExampleBox").style.display="none";

  // mismatch warning
  if(p.bloom_reason.toLowerCase()!==bloomKey){
    $("bloomWarn").innerHTML=
      `⚠ Selected Bloom (<strong>${bloomSel.value}</strong>) is higher than the recommended Bloom level (<strong>${p.bloom_reason}</strong>) for ${ploSel.value}.`;
    $("bloomWarn").style.display="block";
  } else {
    $("bloomWarn").style.display="none";
  }

  fetch(`/api/get_verbs/${ploSel.value}/${bloomSel.value}`)
    .then(r=>r.json())
    .then(v=>{
      verbSel.innerHTML='<option value="">Select Verb</option>';
      v.forEach(x=>verbSel.add(new Option(x,x)));
    });
});

// Generate CLO
$("generateBtn").addEventListener("click",()=>{
  if(!$("content").value.trim()) return alert("Please enter content.");
  fetch("/generate",{
    method:"POST",
    body:new FormData(document.querySelector("form")||undefined)
  });
});

// Downloads
$("downloadBtn").addEventListener("click",()=>window.location="/download");
$("rubricBtn").addEventListener("click",()=>window.location="/download_rubric");
</script>

</body>
</html>
