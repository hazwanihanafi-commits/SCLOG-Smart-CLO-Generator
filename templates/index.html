<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SCLOG — Smart CLO Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f5f3ff;font-family:system-ui}
.card-box{background:#fff;border-radius:14px;padding:16px;border:1px solid #e5e7eb}
.step-header{font-weight:800;color:#4c1d95}
.step-desc{font-size:.9rem;color:#6b7280}
.logic-box{background:#f7f2ff;border-radius:10px;padding:12px}
.bloom-tag{font-size:.75rem;font-weight:900;background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px}
.badge-plo{background:#ede9fe;color:#6d28d9}
.small-muted{font-size:.8rem;color:#6b7280}
</style>
</head>

<body>
<div class="container my-4">

<!-- HEADER -->
<div class="card-box mb-3">
  <h3 style="color:#6d28d9;font-weight:900">SCLOG</h3>
  <div class="text-muted">Smart Course Learning Outcome Generator (MQF 2.0 + VBE)</div>
</div>

<!-- TABS -->
<ul class="nav nav-tabs mb-3">
  <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#programme">Programme Design</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#plo">PLO Only</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#clo">CLO Only</button></li>
</ul>

<div class="tab-content">

<!-- ================================================= PROGRAMME DESIGN -->
<div class="tab-pane fade show active" id="programme">
<div class="card-box mb-3">

<div class="step-header">Programme Design</div>
<div class="step-desc">
Auto-generate PEOs based on programme name, MQF level and Values-Based Education.
</div>

<label class="form-label">Programme Name</label>
<input id="programmeName" class="form-control"
 placeholder="e.g. Bachelor of Computer Science (Data Science & Analytics)">

<label class="form-label mt-2">Programme Level</label>
<select id="level" class="form-select">
  <option value="">Select</option>
  <option>Diploma</option>
  <option>Degree</option>
  <option>Master</option>
  <option>PhD</option>
</select>

<button id="generatePEO" class="btn btn-outline-primary mt-3">
Suggest Programme Educational Objectives (PEOs)
</button>

<div id="peoSuggestions" class="mt-3"></div>

<label class="form-label mt-3">Select PEO</label>
<select id="peoSelect" class="form-select"></select>

<label class="form-label mt-3">Mapped PLO</label>
<select id="plo_programme" class="form-select"></select>

</div>
</div>

<!-- ================================================= PLO ONLY -->
<div class="tab-pane fade" id="plo">
<div class="card-box mb-3">
<div class="step-header">PLO Only</div>
<div class="step-desc">Generate CLO directly from USM Programme Learning Outcome.</div>
<select id="plo_only" class="form-select"></select>
</div>
</div>

<!-- ================================================= CLO ONLY -->
<div class="tab-pane fade" id="clo">
<div class="card-box mb-3">
<div class="step-header">CLO Only</div>
<div class="step-desc">Generate CLO without programme-level mapping.</div>
</div>
</div>

</div>

<!-- ================================================= CLO BUILDER -->
<div class="card-box mt-4">
<div class="d-flex align-items-center gap-2 mb-2">
  <h5 class="mb-0">Smart CLO Builder</h5>
  <span id="bloomTag" class="bloom-tag">—</span>
</div>

<div class="row g-3">

<div class="col-md-4">
  <label class="form-label">Bloom Level</label>
  <select id="bloom" class="form-select"></select>
  <div id="bloomDesc" class="small-muted mt-1">—</div>
</div>

<div class="col-md-4">
  <label class="form-label">Action Verb</label>
  <select id="verb" class="form-select"></select>
</div>

<div class="col-md-4">
  <label class="form-label">Content</label>
  <input id="content" class="form-control"
   placeholder="e.g. data analytics techniques">
</div>

<div class="col-12">
  <button id="generateBtn" class="btn btn-primary">Generate CLO</button>
</div>

<div id="cloCard" class="col-12 mt-3" style="display:none">

<div class="logic-box">
<strong>CLO</strong>
<div id="clo_text"></div>
</div>

<div class="logic-box mt-2">
<strong>Variants</strong>
<div id="variantsPanel"></div>
</div>

<div class="logic-box mt-2">
<strong>Assessment</strong>
<ul id="assessList"></ul>
</div>

<div class="logic-box mt-2">
<strong>Evidence</strong>
<ul id="evidenceList"></ul>
</div>

<div class="mt-3 d-flex gap-2">
<button class="btn btn-success" onclick="location.href='/download'">Download CLO</button>
<button class="btn btn-outline-secondary" onclick="location.href='/download_rubric'">Download Rubric</button>
</div>

</div>
</div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const $=id=>document.getElementById(id);

/* ================= USM PLO ================= */
const USM_PLO={
 PLO1:"Knowledge",PLO2:"Cognitive",PLO3:"Practical",
 PLO4:"Interpersonal",PLO5:"Communication",
 PLO6:"Digital",PLO7:"Numeracy",
 PLO8:"Leadership",PLO9:"Personal",
 PLO10:"Entrepreneurial",PLO11:"Ethics"
};

/* ================= VBE + BLOOM ================= */
const VBE_BY_LEVEL = {
  Diploma: {
    bloom: {
      C: ["remember", "understand", "apply"],
      A: ["receiving", "responding"],
      P: ["perception", "set", "guided response"]
    },
    verbs: ["demonstrate", "apply", "perform"],
    values: ["Discipline", "Responsibility"],
    focus: "work readiness, basic professional skills, and ethical conduct"
  },

  Degree: {
    bloom: {
      C: ["understand", "apply", "analyze"],
      A: ["responding", "valuing"],
      P: ["guided response", "mechanism"]
    },
    verbs: ["apply", "analyze", "evaluate"],
    values: ["Integrity", "Justice"],
    focus: "professional practice, problem-solving, and societal responsibility"
  },

  Master: {
    bloom: {
      C: ["analyze", "evaluate", "integrate"],
      A: ["valuing", "organization"],
      P: ["mechanism", "adaptation"]
    },
    verbs: ["analyze", "evaluate", "integrate"],
    values: ["Wisdom", "Accountability"],
    focus: "advanced analysis, professional judgment, and leadership in practice"
  },

  PhD: {
    bloom: {
      C: ["create"],
      A: ["characterization"],
      P: ["adaptation", "origination"]
    },
    verbs: ["create", "advance", "innovate"],
    values: ["Truth", "Global Responsibility"],
    focus: "knowledge creation, ethical leadership, and global impact"
  }
};

function bloomTag(b,level){
 const map=VBE_BY_LEVEL[level]?.bloom||{};
 b=b.toLowerCase();
 if(map.C?.includes(b))return"C";
 if(map.A?.includes(b))return"A";
 if(map.P?.includes(b))return"P";
 return"—";
}

/* ================= INIT ================= */
fill($("plo_only"),Object.keys(USM_PLO));
function fill(sel,list){sel.innerHTML='<option value="">Select</option>';list.forEach(v=>sel.add(new Option(v,v)));}

/* ================= PEO GENERATION ================= */
$("generatePEO").onclick=()=>{
 const name=$("programmeName").value;
 const level=$("level").value;
 if(!name||!level){alert("Enter programme name and level");return;}

 const values=VBE_BY_LEVEL[level].values;
 const peos=[
  {code:"PEO1",plos:["PLO1","PLO2","PLO3","PLO6"],text:`Graduates of the ${name} demonstrate strong disciplinary knowledge and professional competence guided by ${values[0]}.`},
  {code:"PEO2",plos:["PLO4","PLO5"],text:`Graduates of the ${name} communicate and collaborate effectively guided by ${values[1]}.`},
  {code:"PEO3",plos:["PLO8","PLO9"],text:`Graduates of the ${name} demonstrate leadership and lifelong learning guided by ${values[0]}.`},
  {code:"PEO4",plos:["PLO10"],text:`Graduates of the ${name} apply innovation and entrepreneurship guided by ${values[1]}.`},
  {code:"PEO5",plos:["PLO11"],text:`Graduates of the ${name} uphold ethics and professionalism guided by ${values[0]}.`}
 ];

 $("peoSuggestions").innerHTML="";
 peos.forEach(p=>{
  $("peoSuggestions").innerHTML+=`
  <div class="logic-box mb-2">
   <strong>${p.code}</strong><br>${p.text}
   <div class="mt-1">${p.plos.map(x=>`<span class="badge badge-plo me-1">${x}</span>`).join("")}</div>
  </div>`;
 });

 fill($("peoSelect"),peos.map(p=>p.code));
 $("peoSelect").dataset.map=JSON.stringify(peos);
};

$("peoSelect").onchange=()=>{
 const peos=JSON.parse($("peoSelect").dataset.map||"[]");
 const p=peos.find(x=>x.code===$("peoSelect").value);
 if(!p)return;
 fill($("plo_programme"),p.plos);
};

/* ================= PLO → BLOOM ================= */
function hookPLO(sel){
 sel.onchange=async()=>{
  if(!sel.value)return;
  fill($("bloom"),await fetch(`/api/get_blooms/${sel.value}`).then(r=>r.json()));
 };
}
hookPLO($("plo_programme"));
hookPLO($("plo_only"));

$("bloom").onchange=()=>{
 const level=$("level").value||"Degree";
 const b=$("bloom").value;
 $("bloomTag").textContent=`${bloomTag(b,level)} · ${b}`;
 $("bloomDesc").innerHTML=`Why ${b}? Required at ${level} level for ${VBE_BY_LEVEL[level].focus}.`;
};

/* ================= BLOOM → VERB ================= */
$("bloom").addEventListener("change",async()=>{
 const plo=$("plo_programme").value||$("plo_only").value;
 if(!plo)return;
 fill($("verb"),await fetch(`/api/get_verbs/${plo}/${$("bloom").value}`).then(r=>r.json()));
});

/* ================= GENERATE ================= */
$("generateBtn").onclick=async()=>{
 const fd=new FormData();
 fd.append("plo",$("plo_programme").value||$("plo_only").value||"");
 fd.append("bloom",$("bloom").value);
 fd.append("verb",$("verb").value);
 fd.append("content",$("content").value);

 const d=await fetch("/generate",{method:"POST",body:fd}).then(r=>r.json());
 $("clo_text").textContent=d.clo;
 $("variantsPanel").innerHTML=Object.values(d.variants||{}).map(v=>`<div>${v}</div>`).join("");
 $("assessList").innerHTML=d.assessments.map(a=>`<li>${a}</li>`).join("");
 $("evidenceList").innerHTML=Object.values(d.evidence).flat().map(e=>`<li>${e}</li>`).join("");
 $("cloCard").style.display="block";
};
</script>
</body>
</html>
