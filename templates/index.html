<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SCLOG — Smart CLO Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f5f3ff;font-family:system-ui}
.card-box{background:#fff;border-radius:14px;padding:16px;border:1px solid #e5e7eb}
.step-header{font-weight:800;color:#4c1d95}
.step-desc{font-size:.9rem;color:#6b7280}
.logic-box{background:#f7f2ff;border-radius:10px;padding:12px}
.bloom-tag{font-size:.7rem;font-weight:900;background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px}
.muted{color:#6b7280;font-size:.85rem}
</style>
</head>

<body>
<div class="container my-4">

<!-- HEADER -->
<div class="card-box mb-3">
  <h3 style="color:#6d28d9;font-weight:900">SCLOG</h3>
  <div class="text-muted">Smart Course Learning Outcome Generator</div>
</div>

<!-- MODE TABS -->
<ul class="nav nav-tabs mb-3">
  <li class="nav-item">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#programmeTab">
      Programme Design
    </button>
  </li>
</ul>

<div class="tab-content">

<!-- ================= PROGRAMME DESIGN ================= -->
<div class="tab-pane fade show active" id="programmeTab">

  <!-- STEP 1 -->
  <div class="card-box mb-3">
    <div class="step-header">Step 1 · Programme Context</div>
    <div class="step-desc">
      Paste the Institutional Educational Goal (IEG) and define programme level
      and discipline.
    </div>

    <label class="form-label">Programme Level</label>
    <select id="level" class="form-select mb-2">
      <option value="">Select level</option>
      <option>Diploma</option>
      <option>Degree</option>
      <option>Master</option>
      <option>PhD</option>
    </select>

    <label class="form-label">Discipline</label>
    <select id="discipline" class="form-select mb-2">
      <option value="">Select discipline</option>
      <option value="health">Medical & Health</option>
      <option value="engineering">Engineering</option>
      <option value="computing">Computing</option>
      <option value="education">Education</option>
      <option value="business">Business</option>
      <option value="social">Social Sciences</option>
      <option value="arts">Arts & Humanities</option>
    </select>

    <label class="form-label">Institutional Educational Goal (IEG)</label>
    <textarea id="ieg_text" class="form-control" rows="3"
      placeholder="Paste official IEG statement here"></textarea>

    <button id="generatePEOBtn" class="btn btn-outline-primary mt-3">
      Suggest Programme Educational Objectives (PEOs)
    </button>
  </div>

  <!-- STEP 2 -->
  <div class="card-box mb-3">
    <div class="step-header">Step 2 · Suggested Programme Educational Objectives (PEO)</div>
    <div class="step-desc">
      The following PEOs are generated based on IEG, programme level,
      discipline, and Values-Based Education (VBE).
    </div>

    <div id="peoSuggestions">—</div>
  </div>

  <!-- STEP 3 -->
  <div class="card-box mb-3">
    <div class="step-header">Step 3 · Programme Learning Outcomes (PLO)</div>
    <div class="step-desc">
      Select a PLO aligned with the chosen PEO.
    </div>

    <label class="form-label">Select PLO</label>
    <select id="plo_programme" class="form-select"></select>
  </div>

</div>
</div>

<!-- ================= CLO BUILDER ================= -->
<div class="card-box mt-4">
  <div class="d-flex align-items-center gap-2 mb-2">
    <h5 class="mb-0">Smart CLO Builder</h5>
    <span id="bloomTag" class="bloom-tag">—</span>
  </div>

  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">Bloom</label>
      <select id="bloom" class="form-select"></select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Verb</label>
      <select id="verb" class="form-select"></select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Content</label>
      <input id="content" class="form-control"
        placeholder="e.g. ECG waveform interpretation">
    </div>

    <div class="col-12">
      <button id="generateBtn" class="btn btn-primary">
        Generate CLO
      </button>
    </div>

    <div id="cloCard" class="col-12 mt-3" style="display:none">
      <div class="logic-box">
        <strong>CLO:</strong>
        <div id="clo_text"></div>
      </div>
    </div>
  </div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const $ = id => document.getElementById(id);

/* ================= VBE PROFILES ================= */
const VBE_BY_LEVEL = {
  Diploma:{verbs:["demonstrate","apply"],values:["Responsibility","Discipline"],focus:"work readiness"},
  Degree:{verbs:["apply","analyze"],values:["Integrity","Justice"],focus:"professional practice"},
  Master:{verbs:["evaluate","lead"],values:["Wisdom","Accountability"],focus:"advanced leadership"},
  PhD:{verbs:["create","advance"],values:["Truth","Global Responsibility"],focus:"knowledge creation"}
};

const DISCIPLINE_CONTEXT = {
  health:"healthcare practice",
  engineering:"engineering solutions",
  computing:"digital systems",
  education:"teaching practice",
  business:"organizational leadership",
  social:"societal development",
  arts:"cultural expression"
};

/* ================= GENERATE PEO ================= */
function generatePEOsFromIEG(ieg, level, discipline){
  const cfg = VBE_BY_LEVEL[level];
  const context = DISCIPLINE_CONTEXT[discipline] || "professional practice";

  return Array.from({length:5}).map((_,i)=>({
    code:`PEO${i+1}`,
    vbe:cfg.values[i % cfg.values.length],
    statement:
      `Graduates ${cfg.verbs[i % cfg.verbs.length]} professional competence in ${context}, guided by ${cfg.values[i % cfg.values.length].toLowerCase()}, in alignment with the Institutional Educational Goal.`,
    rationale:
      `This PEO translates the IEG into measurable graduate outcomes at ${level} level, embedding ${cfg.values[i % cfg.values.length]} as a core VBE principle.`
  }));
}

function renderPEOs(peos){
  const box = $("peoSuggestions");
  box.innerHTML="";
  peos.forEach(p=>{
    box.innerHTML += `
      <div class="logic-box mb-3">
        <strong>${p.code}</strong>
        <div>${p.statement}</div>
        <div class="muted mt-2">
          <strong>VBE:</strong> ${p.vbe}<br>
          <strong>Why this PEO:</strong> ${p.rationale}
        </div>
      </div>
    `;
  });
}

/* ================= EVENTS ================= */
$("generatePEOBtn").addEventListener("click",()=>{
  const ieg = $("ieg_text").value.trim();
  const level = $("level").value;
  const discipline = $("discipline").value;

  if(!ieg || !level || !discipline){
    alert("Please complete IEG, level, and discipline.");
    return;
  }

  renderPEOs(generatePEOsFromIEG(ieg,level,discipline));
});

/* ================= PLO → BLOOM ================= */
$("plo_programme")?.addEventListener("change",async()=>{
  const plo = $("plo_programme").value;
  if(!plo) return;
  fill($("bloom"), await fetch(`/api/get_blooms/${plo}`).then(r=>r.json()));
});

$("bloom")?.addEventListener("change",async()=>{
  const plo = $("plo_programme").value;
  if(!plo) return;
  fill($("verb"), await fetch(`/api/get_verbs/${plo}/${$("bloom").value}`).then(r=>r.json()));
});

$("generateBtn").addEventListener("click",async()=>{
  const fd = new FormData();
  fd.append("plo",$("plo_programme").value);
  fd.append("bloom",$("bloom").value);
  fd.append("verb",$("verb").value);
  fd.append("content",$("content").value);

  const data = await fetch("/generate",{method:"POST",body:fd}).then(r=>r.json());
  $("clo_text").textContent=data.clo;
  $("cloCard").style.display="block";
});

function fill(sel,list=[]){
  sel.innerHTML='<option value="">Select</option>';
  list.forEach(v=>sel.add(new Option(v,v)));
}
</script>

</body>
</html>
