<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>SCLOG â€” Smart CLO Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HMBYNXRLBE"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-HMBYNXRLBE');
</script>

<style>
:root{
  --usm-purple:#6d28d9;
  --bg:#f5f3ff;
}
body{background:var(--bg);font-family:system-ui;color:#2a2344}
.card-box{background:#fff;border-radius:14px;padding:16px;border:1px solid rgba(109,40,217,.1)}
.step-header{font-weight:800;color:#4c1d95}
.step-desc{font-size:.9rem;color:#6b7280}
.logic-box{background:#f7f2ff;border-radius:10px;padding:12px}
.bloom-tag{font-size:.75rem;font-weight:900;background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px}
.badge-plo{background:#ede9fe;color:#6d28d9}
.small-muted{font-size:.8rem;color:#6b7280}
</style>
</head>

<body>
<div class="container my-4">

<!-- HEADER -->
<div class="card-box mb-3 d-flex justify-content-between align-items-center">
  <div>
    <h3 style="color:#6d28d9;font-weight:900">
      <i class="bi bi-stars"></i> SCLOG
    </h3>
    <div class="text-muted">
      Smart Course Learning Outcome Generator â€” MQF 2.0 & VBE
    </div>
  </div>
</div>

<!-- ================= STEP 1 : PROGRAMME DESIGN ================= -->
<div class="card-box mb-3">
<div class="step-header">STEP 1 Â· Programme Design</div>
<div class="step-desc">
Auto-generate Programme Educational Objectives (PEO) aligned with programme name,
MQF level and Values-Based Education (VBE).
</div>

  <!-- STEP 1 -->
<div class="card-box mb-3">

  <div class="d-flex align-items-center gap-2 mb-1">
    <span class="step-pill">STEP 1</span>
    <div class="step-header mb-0">
      Institutional Educational Goal (IEG)
    </div>
  </div>

  <div class="step-desc">
    Define the Institutional Educational Goal (IEG) that articulates the
    overarching educational philosophy and graduate attributes endorsed by
    the institution. The IEG serves as the foundation for the formulation of
    Programme Educational Objectives (PEO) and subsequent outcome mapping in
    accordance with Outcome-Based Education (OBE) and MQA requirements.
  </div>

  <div class="step-divider"></div>

  <label class="form-label">
    Institutional Educational Goal (IEG)
  </label>

  <div class="muted mb-1" style="font-size:0.85rem">
    Paste the official IEG statement defined by your institution.
  </div>

  <textarea
    id="ieg_text"
    class="form-control"
    rows="4"
    placeholder="e.g. To produce graduates who are intellectually competent, ethically grounded, socially responsible, and capable of contributing meaningfully to national and global development.">
  </textarea>

</div>


<label class="form-label">Programme Name</label>
<input id="programmeName" class="form-control"
 placeholder="e.g. Bachelor of Computer Science (Data Science & Analytics)">

<div class="row g-2 mt-2">
  <div class="col-md-4">
    <label class="form-label">Programme Level</label>
    <select id="level" class="form-select">
      <option value="">Select</option>
      <option>Diploma</option>
      <option>Degree</option>
      <option>Master</option>
      <option>PhD</option>
    </select>
  </div>
</div>

<button id="generatePEO" class="btn btn-outline-primary mt-3">
Suggest Programme Educational Objectives (PEOs)
</button>

<div id="peoSuggestions" class="mt-3"></div>

<label class="form-label mt-3">Select PEO</label>
<select id="peoSelect" class="form-select"></select>

<label class="form-label mt-3">Mapped Programme Learning Outcomes (USM)</label>
<select id="plo_programme" class="form-select"></select>
</div>

<!-- ================= STEP 2 & 3 : CLO BUILDER ================= -->
<div class="card-box mt-4">

<div class="d-flex align-items-center gap-2 mb-2">
  <h5 class="mb-0">Smart CLO Builder</h5>
  <span id="bloomTag" class="bloom-tag">â€”</span>
</div>

<div class="row g-3">
<div class="col-md-4">
  <label class="form-label">Bloom Level</label>
  <select id="bloom" class="form-select"></select>
  <div id="bloomDesc" class="small-muted mt-1">â€”</div>
</div>

<div class="col-md-4">
  <label class="form-label">Action Verb</label>
  <select id="verb" class="form-select"></select>
</div>

<div class="col-md-4">
  <label class="form-label">Content / Focus</label>
  <input id="content" class="form-control"
   placeholder="e.g. data analytics techniques">
</div>

<div class="col-12">
  <button id="generateBtn" class="btn btn-primary">
    <i class="bi bi-magic"></i> Generate CLO
  </button>
</div>

<div id="cloCard" class="col-12 mt-3" style="display:none">

<div class="logic-box">
<strong>CLO</strong>
<div id="clo_text"></div>
</div>

<div class="logic-box mt-2">
<strong>Variants</strong>
<div id="variantsPanel"></div>
</div>

<div class="logic-box mt-2">
<strong>Assessment</strong>
<ul id="assessList"></ul>
</div>

<div class="logic-box mt-2">
<strong>Evidence</strong>
<ul id="evidenceList"></ul>
</div>

<div class="mt-3 d-flex gap-2">
<button class="btn btn-success" onclick="location.href='/download'">
<i class="bi bi-download"></i> Download CLO
</button>
<button class="btn btn-outline-secondary" onclick="location.href='/download_rubric'">
<i class="bi bi-file-earmark-text"></i> Download Rubric
</button>
</div>

</div>
</div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const $=id=>document.getElementById(id);

/* ================= USM PLO ================= */
const USM_PLO={
 PLO1:"Knowledge",PLO2:"Cognitive",PLO3:"Practical",
 PLO4:"Interpersonal",PLO5:"Communication",
 PLO6:"Digital",PLO7:"Numeracy",
 PLO8:"Leadership",PLO9:"Personal",
 PLO10:"Entrepreneurial",PLO11:"Ethics"
};

/* ================= VBE + BLOOM BY LEVEL ================= */
const VBE_BY_LEVEL={
 Diploma:{
  bloom:{C:["remember","understand","apply"],A:["receiving","responding"],P:["perception","set","guided response"]},
  values:["discipline","responsibility"],
  focus:"work readiness and ethical conduct"
 },
 Degree:{
  bloom:{C:["understand","apply","analyze"],A:["responding","valuing"],P:["guided response","mechanism"]},
  values:["integrity","justice"],
  focus:"professional practice and societal responsibility"
 },
 Master:{
  bloom:{C:["analyze","evaluate","integrate"],A:["valuing","organization"],P:["mechanism","adaptation"]},
  values:["wisdom","accountability"],
  focus:"advanced professional judgement and leadership"
 },
 PhD:{
  bloom:{C:["create"],A:["characterization"],P:["adaptation","origination"]},
  values:["truth","global responsibility"],
  focus:"knowledge creation and ethical leadership"
 }
};

function bloomDomainTag(bloom,level){
 const m=VBE_BY_LEVEL[level]?.bloom||{};
 bloom=bloom.toLowerCase();
 if(m.C?.includes(bloom))return"C";
 if(m.A?.includes(bloom))return"A";
 if(m.P?.includes(bloom))return"P";
 return"â€”";
}

/* ================= INIT ================= */
fill($("plo_programme"),[]);
function fill(sel,list){sel.innerHTML='<option value="">Select</option>';list.forEach(v=>sel.add(new Option(v,v)));}

/* ================= PEO GENERATION ================= */
$("generatePEO").onclick=()=>{
 const name=$("programmeName").value;
 const level=$("level").value;
 if(!name||!level){alert("Enter programme name and level");return;}

 const values=VBE_BY_LEVEL[level].values;
 const peos=[
  {code:"PEO1",plos:["PLO1","PLO2","PLO3","PLO6","PLO7"],text:`Graduates of the ${name} demonstrate strong disciplinary knowledge and professional competence guided by ${values[0]}.`},
  {code:"PEO2",plos:["PLO4","PLO5"],text:`Graduates of the ${name} communicate and collaborate effectively guided by ${values[1]}.`},
  {code:"PEO3",plos:["PLO8","PLO9"],text:`Graduates of the ${name} demonstrate leadership and lifelong learning guided by ${values[0]}.`},
  {code:"PEO4",plos:["PLO10"],text:`Graduates of the ${name} apply innovation and entrepreneurship guided by ${values[1]}.`},
  {code:"PEO5",plos:["PLO11"],text:`Graduates of the ${name} uphold ethics and professionalism guided by ${values[0]}.`}
 ];

 $("peoSuggestions").innerHTML="";
 peos.forEach(p=>{
  $("peoSuggestions").innerHTML+=`
  <div class="logic-box mb-2">
   <strong>${p.code}</strong><br>${p.text}
   <div class="mt-1">${p.plos.map(x=>`<span class="badge badge-plo me-1">${x}</span>`).join("")}</div>
  </div>`;
 });

 fill($("peoSelect"),peos.map(p=>p.code));
 $("peoSelect").dataset.map=JSON.stringify(peos);
};

$("peoSelect").onchange=()=>{
 const peos=JSON.parse($("peoSelect").dataset.map||"[]");
 const p=peos.find(x=>x.code===$("peoSelect").value);
 if(!p)return;
 fill($("plo_programme"),p.plos);
};

/* =====================================================
   ðŸ”¥ CORE LOGIC: PLO â†’ STATEMENT + INDICATOR + BLOOM
===================================================== */
$("plo_programme").addEventListener("change", async () => {
  const plo = $("plo_programme").value;

  $("bloom").innerHTML = '<option value="">Select Bloom</option>';
  $("verb").innerHTML = '<option value="">Select Verb</option>';
  $("bloomDesc").textContent = "Select a Bloom level to see its description.";
  $("bloomTag").textContent = "â€”";

  $("assessList").innerHTML = "";
  $("evidenceList").innerHTML = "";

  if (!plo) return;

  /* 1ï¸âƒ£ PLO STATEMENT */
  try {
    const level = $("level").value || "Degree";
    const res = await fetch(
      `/api/get_statement/${encodeURIComponent(level)}/PLO/${encodeURIComponent(plo)}`
    );
    const stmt = await res.json();
    console.log("PLO STATEMENT:", stmt);
  } catch (e) {
    console.error("PLO statement error", e);
  }

  /* 2ï¸âƒ£ PLO INDICATOR */
  console.log("PLO INDICATOR:", MAP.PLOIndicators?.[plo] || "â€”");

  /* 3ï¸âƒ£ LOAD BLOOM */
  try {
    const res = await fetch(`/api/get_blooms/${encodeURIComponent(plo)}`);
    const blooms = await res.json();

    blooms.forEach(b => $("bloom").add(new Option(b, b)));

    if (blooms.length > 0) {
      $("bloom").value = blooms[0];
      $("bloom").dispatchEvent(new Event("change"));
    }
  } catch (e) {
    console.error("PLO â†’ Bloom error", e);
  }
});

/* =========================
   BLOOM â†’ TAG + DESC + VERB
========================= */
$("bloom").addEventListener("change", async () => {
  const bloom = $("bloom").value;
  const level = $("level").value || "Degree";
  const plo = $("plo_programme").value;

  if (!bloom || !plo) return;

  const tag = bloomDomainTag(bloom, level);
  $("bloomTag").textContent = `${tag} Â· ${bloom}`;

  $("bloomDesc").innerHTML =
    `<strong>Why ${bloom}?</strong><br>
     At ${level} level, learners are expected to <em>${bloom}</em>,
     aligned with ${VBE_BY_LEVEL[level].focus}.`;

  try {
    const res = await fetch(`/api/get_verbs/${encodeURIComponent(plo)}/${encodeURIComponent(bloom)}`);
    const verbs = await res.json();
    fill($("verb"), verbs);
  } catch (e) {
    console.error("Verb load error", e);
  }
});

/* =====================================================
   ðŸ”¥ GENERATE CLO (FINAL)
===================================================== */
$("generateBtn").addEventListener("click", async () => {
  if (
    !$("plo_programme").value ||
    !$("bloom").value ||
    !$("verb").value ||
    !$("content").value.trim()
  ) {
    alert("Please fill PLO, Bloom, Verb and Content.");
    return;
  }

  const fd = new FormData();
  fd.append("plo", $("plo_programme").value);
  fd.append("bloom", $("bloom").value);
  fd.append("verb", $("verb").value);
  fd.append("content", $("content").value);
  fd.append("level", $("level").value || "Degree");

  try {
    const res = await fetch("/generate", { method: "POST", body: fd });
    const data = await res.json();

    $("clo_text").innerText = data.clo;
    $("cloCard").style.display = "block";

    /* Variants */
    $("variantsPanel").innerHTML = "";
    Object.values(data.variants || {}).forEach(v => {
      $("variantsPanel").innerHTML += `<div>${v}</div>`;
    });

    /* Assessment */
    $("assessList").innerHTML =
      data.assessments.map(a => `<li>${a}</li>`).join("");

    /* Evidence */
    $("evidenceList").innerHTML =
      Object.values(data.evidence || {}).flat().map(e => `<li>${e}</li>`).join("");

  } catch (e) {
    console.error("Generate CLO error", e);
    alert("Error generating CLO");
  }
});
</script>
</body>
</html>
